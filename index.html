<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Data Bundle Website</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to right, #141e30, #243b55);
      color: white;
      margin: 0;
      padding: 0;
    }
    header {
      background: rgba(0,0,0,0.7);
      padding: 15px;
      text-align: center;
    }
    nav button {
      margin: 5px;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background: #ff9800;
      color: white;
      font-weight: bold;
    }
    nav button:hover {
      background: #e68900;
    }
    .tab {
      display: none;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    .active {
      display: block;
    }
    .notice {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 14px;
      line-height: 1.6;
    }
    input, select {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border-radius: 8px;
      border: none;
      font-size: 16px;
    }
    button.action {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border: none;
      border-radius: 8px;
      background: #4CAF50;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    button.action:hover {
      background: #45a049;
    }
    .card {
      background: rgba(255,255,255,0.1);
      padding: 15px;
      margin: 10px 0;
      border-radius: 8px;
      text-align: left;
    }
  </style>
</head>
<body>
  <header>
    <h1>ðŸ“± Data Bundle Store</h1>
    <div>
      <input type="email" id="adminEmail" placeholder="Admin Email">
      <input type="password" id="adminPassword" placeholder="Admin Password">
      <button id="adminLoginBtn">Admin Login</button>
      <button id="logoutBtn" style="display:none;">Logout</button>
    </div>
    <nav>
      <button onclick="showTab('buyTab')">Buy Data</button>
      <button onclick="showTab('ordersTab')">My Orders</button>
      <button id="adminTabBtn" style="display:none;" onclick="showTab('adminTab')">Admin Panel</button>
    </nav>
  </header>

  <!-- Buy Data Tab -->
  <div id="buyTab" class="tab active">
    <div class="notice">
      <p>ðŸ“¢ <strong>Notice:</strong></p>
      <p>We work from <b>Monday to Saturday only</b>. No service on Sundays.</p>
      <p>Send payment to <b>0502376541</b> ðŸ“±</p>
      <p><b>Vodafone users:</b> Send directly.<br>
         <b>MTN users:</b> Choose <i>Other Network</i> when sending.</p>
    </div>
    <input type="text" id="phone" placeholder="Enter Phone Number" required>
    <select id="bundle">
      <!-- MTN Bundles -->
      <option value="MTN 1GB - 6">MTN 1GB - GHS 6</option>
      <option value="MTN 2GB - 11">MTN 2GB - GHS 11</option>
      <option value="MTN 4GB - 22">MTN 4GB - GHS 22</option>
      <option value="MTN 3GB - 17">MTN 3GB - GHS 17</option>
      <option value="MTN 5GB - 26">MTN 5GB - GHS 26</option>
      <option value="MTN 6GB - 31">MTN 6GB - GHS 31</option>
      <option value="MTN 7GB - 35">MTN 7GB - GHS 35</option>
      <option value="MTN 8GB - 45">MTN 8GB - GHS 45</option>
      <option value="MTN 9GB - 50">MTN 9GB - GHS 50</option>
      <option value="MTN 10GB - 50">MTN 10GB - GHS 50</option>
      <option value="MTN 15GB - 67">MTN 15GB - GHS 67</option>
      <option value="MTN 20GB - 86">MTN 20GB - GHS 86</option>
      <option value="MTN 25GB - 135">MTN 25GB - GHS 135</option>
      <option value="MTN 30GB - 145">MTN 30GB - GHS 145</option>
      <option value="MTN 40GB - 165">MTN 40GB - GHS 165</option>

      <!-- Vodafone Bundles -->
      <option value="Vodafone 5GB - 25">Vodafone 5GB - GHS 25</option>
      <option value="Vodafone 10GB - 50">Vodafone 10GB - GHS 50</option>
      <option value="Vodafone 15GB - 68">Vodafone 15GB - GHS 68</option>
      <option value="Vodafone 20GB - 85">Vodafone 20GB - GHS 85</option>
      <option value="Vodafone 30GB - 125">Vodafone 30GB - GHS 125</option>
      <option value="Vodafone 40GB - 147">Vodafone 40GB - GHS 147</option>
      <option value="Vodafone 50GB - 220">Vodafone 50GB - GHS 220</option>
    </select>
    <button class="action" onclick="buyBundle()">Buy Bundle</button>
    <p id="msg"></p>
  </div>

  <!-- Orders Tab -->
  <div id="ordersTab" class="tab">
    <h2>My Orders</h2>
    <div id="myOrders"></div>
  </div>

  <!-- Admin Tab -->
  <div id="adminTab" class="tab">
    <h2>Admin Panel</h2>
    <div id="orders"></div>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, query, where, updateDoc, doc } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCeQUlim7qlhHJb3tXHs7ynUE4TRwjdY9k",
      authDomain: "databundleapp-1d67b.firebaseapp.com",
      projectId: "databundleapp-1d67b",
      storageBucket: "databundleapp-1d67b.appspot.com",
      messagingSenderId: "1075441944120",
      appId: "1:1075441944120:web:788de7ecc35241b21dc8cd",
      measurementId: "G-F8XWVELMNK"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const adminEmail = "colemancyrus5@gmail.com";

    function showTab(tabId) {
      document.querySelectorAll(".tab").forEach(tab => tab.classList.remove("active"));
      document.getElementById(tabId).classList.add("active");
    }

    // Buy Bundle
    async function buyBundle() {
      const phone = document.getElementById("phone").value;
      const bundle = document.getElementById("bundle").value;
      const msg = document.getElementById("msg");

      if (!phone) {
        msg.innerText = "âš ï¸ Enter your phone number";
        return;
      }

      try {
        await addDoc(collection(db, "orders"), {
          phone, bundle, status: "pending", createdAt: new Date()
        });
        msg.innerText = "âœ… Order placed! Please pay 0502376541.";
        loadMyOrders(phone);
      } catch (e) {
        msg.innerText = "âŒ Error: " + e.message;
      }
    }

    // Load my orders
    async function loadMyOrders(phone) {
      const q = query(collection(db, "orders"), where("phone", "==", phone));
      const snapshot = await getDocs(q);
      const container = document.getElementById("myOrders");
      container.innerHTML = "";
      snapshot.forEach((docSnap) => {
        const data = docSnap.data();
        container.innerHTML += `<div class="card"><b>${data.bundle}</b><br>Phone: ${data.phone}<br>Status: ${data.status}</div>`;
      });
    }

    // Admin Login
    document.getElementById("adminLoginBtn").addEventListener("click", async () => {
      const email = document.getElementById("adminEmail").value;
      const password = document.getElementById("adminPassword").value;
      try {
        await signInWithEmailAndPassword(auth, email, password);
        alert("âœ… Logged in as admin");
      } catch (e) {
        alert("âŒ " + e.message);
      }
    });

    // Logout
    document.getElementById("logoutBtn").addEventListener("click", async () => {
      await signOut(auth);
      alert("Logged out");
    });

    // Auth state
    onAuthStateChanged(auth, (user) => {
      if (user && user.email === adminEmail) {
        document.getElementById("adminTabBtn").style.display = "inline-block";
        document.getElementById("logoutBtn").style.display = "inline-block";
        loadOrders();
      } else {
        document.getElementById("adminTabBtn").style.display = "none";
        document.getElementById("logoutBtn").style.display = "none";
      }
    });

    // Load all orders (Admin only)
    async function loadOrders() {
      const snapshot = await getDocs(collection(db, "orders"));
      const container = document.getElementById("orders");
      container.innerHTML = "";
      snapshot.forEach((docSnap) => {
        const data = docSnap.data();
        container.innerHTML += `
          <div class="card">
            <b>${data.bundle}</b><br>
            Phone: ${data.phone}<br>
            Status: ${data.status}<br>
            <button onclick="approve('${docSnap.id}')">Approve</button>
            <button onclick="reject('${docSnap.id}')">Reject</button>
          </div>
        `;
      });
    }

    window.approve = async (id) => {
      await updateDoc(doc(db, "orders", id), { status: "approved" });
      loadOrders();
    };
    window.reject = async (id) => {
      await updateDoc(doc(db, "orders", id), { status: "rejected" });
      loadOrders();
    };
  </script>
</body>
  </html>
